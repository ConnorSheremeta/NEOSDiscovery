<div id="holdings">
<table>
  <tr>
    <th class="call-number">Call Number</th>
    <th>Location/Status</th>
    <th>Library</th>
    <th>Item Type</th>
  </tr>

  <br />

  <% @links = @urls.reduce Hash.new, :merge if @urls %>
  <% for item in @holdings %>
    <% @current_loc = @locations[item[:location].downcase.gsub("_","")].gsub("Internet","") %>
      <% @library = @libraries[@current_loc.downcase.gsub(/\s+/, "")] %>
      <% @proxy = @library['proxy'] %>
    <% if @links %>
      <% @links.each{|link| %>
        <% @current_link = "#{@proxy}#{link.last}" if link.first.include?(@current_loc) %>

      <% } %>
    <% end %>

    <% @unavailable = true if @statuses[item[:status].to_s.downcase] == "unavailable" %>
    <tr>
      <% if item[:call] == "Internet Access" %>
        <td><a href="<%= @current_link %>" target="_blank">Internet Access</a></td>
      <% else %>
        <td><%= item[:call] %></td>
      <% end %>
      <% if item[:status] == "CHECKEDOUT" %>
        <% if item[:due] %>
          <td>Due: <%= Date.parse(item[:due]) %></td>
        <% else %><td>Unknown/Never</td>
        <% end %>
      <% else %>
        <td class="holding-status"><%= @statuses[item[:status].to_s.downcase] %>
        <% if @unavailable %>
          <p style="font-size: small"><strong>Note: For access, please contact any University of Alberta Libraries service desk in person or at <a href="http://www.library.ualberta.ca/askus" target="_blank">www.library.ualberta.ca/askus.</a></strong></p>
        <% end %>
        <% if item[:public_note] %>
          <p style="font-size:small"><strong>Note: <%= item[:public_note] %></strong></p>
        <% end %>

        </td>
      <% end %>
      <td><a href="http://catalogue.library.ualberta.ca/sirsi/index.cfm?location=<%= item[:location] %>" target="_blank"><%= @locations[item[:location].downcase.gsub("_","")] %></a></td>
      <%# if @document["format"].include? "Journal" %>
      <%# end %>
      <% if item[:type] and !item[:type].blank? and item[:type].is_a? String %>
        <td class="holding-type"><%= @item_types[item[:type].downcase] %></td>
      <% else %>
        <td></td>
      <% end %>
    </tr>
    <% @unavailable = false %>
  <% end %>
</table>
</div>
